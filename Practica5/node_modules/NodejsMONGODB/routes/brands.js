const express =require('express');
const { route } = require('express/lib/application');
const { model } = require('mongoose');
var router=express.Router();

//llamado al modelo

const Brand=require('../models/brand');

router.get('/',(req,res)=>{
    res.render('pages/brand/brandAddEdit',{
        viewTitle:'Nueva Marca'
    });
})

router.post('/', (req, res)=>{
    if (req.body_id =='')
    saveBrand(req,res);
    else
    updateBrand(req,res);
});

function saveBrand(req,res){
    var brand =new Brand();
    brand.name=req.body.name;
    brand.description=req.body.description;

    brand.save(e =>{
        if (e)
        console.log("Error",e)
        else
        res.redirect('brand/brandList');
    });

}
function updateBrand(req,res){
    Brand.findOneAndUpdate({_id: req.body._id},
        req.body,{new:true},(err,doc)=> {
            if(!err){
                res.redirect('brand/brandList');


            } else{
                console.log("Error", err)
            }
        });
}

router.get('/brandList',( req,res)=> {
    Brand.find((err,docs)=>{
     if(!err){
         res.render('pages/brand/brandList',{
             viewTitle:"Listado de las marcas",
             list:docs
         });
     }else {
    console.log("Error", err);
     }

    });
});

router.get('/:id',(req, res)=>{
    Brand.findById(req.params.id, (err,doc)=>{
        if (!err){
            res.render('pages/brand/brandAddEdit',{
                viewTitle:"Actualizar Marca",
                brand:doc
            })
        }
    });
});

router.get('/delete/:id',(req, res)=>{
    Brand.findByIdAndRemove(req.params.id,e=>{
        if(e)
        console.log("Error",e);
        else
        res.redirect('/brand/brandList');
    });
});

module.exports=router